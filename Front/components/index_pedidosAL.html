<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Pedidos – Aromas Light</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/styles/styles_pedidosAL.css" rel="stylesheet">
</head>
<body>
  

  <main>
    <section class="orders-card" role="region" aria-label="Pedidos del día">
      <div class="orders-header">
        <strong>PEDIDOS</strong>
        <span id="fecha-actual" aria-live="polite"></span>
      </div>
      
      <table class="orders-table" role="table" aria-label="Tabla de pedidos">
        <thead>
          <tr>
            <th scope="col">img</th>
            <th scope="col">descripcion</th>
            <th scope="col">cantidad</th>
          </tr>
        </thead>
        <!-- tbody vacío: JS lo llenará -->
        <tbody id="orders-body"></tbody>
      </table>
    </section>
  </main>

  <script>
  (async function () {
    // fecha
    const fechaSpan = document.getElementById('fecha-actual');
    const fecha = new Date();
    const dia = String(fecha.getDate()).padStart(2, '0');
    const mes = String(fecha.getMonth() + 1).padStart(2, '0');
    const anio = fecha.getFullYear();
    fechaSpan.textContent = `${dia}/${mes}/${anio}`;

    // elementos
    const tbody = document.getElementById('orders-body');

    function setLoading(){
      tbody.innerHTML = `<tr><td colspan="3" class="state">Cargando pedidos…</td></tr>`;
    }
    function setEmpty(){
      tbody.innerHTML = `<tr><td colspan="3" class="state">No hay pedidos para esta fecha.</td></tr>`;
    }
    function setError(msg){
      tbody.innerHTML = `<tr><td colspan="3" class="state error">Error cargando pedidos: ${msg}</td></tr>`;
    }

    setLoading();

    try {
      // fetch del JSON (cache disabled para ver cambios al editar)
      const res = await fetch('pedidos.json', { cache: 'no-store' });
      if (!res.ok) throw new Error(`Servidor respondió ${res.status}`);
      const data = await res.json();

      if (!Array.isArray(data) || data.length === 0) {
        setEmpty();
        return;
      }

      // opcional: map de imágenes por nombre (la data NO incluye imágenes, como pediste)
      const imgMap = {
        "Pasta con salsa boloñesa": "img/pasta-bolonesa.jpg",
        "Milanesa de carne": "img/milanesa-carne.jpg",
        "Pollo al horno con puré de papas": "img/pollo-pure.jpg",
        "Tortilla de papa con ensalada": "img/tortilla-papa.jpg"
      };

      tbody.innerHTML = ''; // limpiar
      data.forEach(item => {
        // seguridad: sanitizar/formatos mínimos
        const desc = String(item.desc || '').trim();
        const cant = Number(item.cant) || 0;
        // elegir imagen (si existe en map), si no usar placeholder
        const imgSrc = imgMap[desc] || 'img/placeholder-48.png';

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><img src="${imgSrc}" alt="${desc}" width="48" height="48"></td>
          <td>${desc}</td>
          <td>${cant}</td>
        `;
        tbody.appendChild(tr);
      });

    } catch (err) {
      setError(err.message);
      console.error(err);
    }
  })();
  </script>
</body>
</html>
